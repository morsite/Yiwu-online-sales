<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Merchandise management</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="../js/jquery-3.6.0.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../css/smana.css">
</head>
<style>
    .input-group{
        width: 70%;
        margin: 0 auto;
        margin-top: 10px;
    }
</style>
<body>

<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">义乌华烨</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li class="active"><a href="Smanager.html">仓库 <span class="sr-only">(current)</span></a></li>
                <li><a href="index.html">首页</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                       aria-haspopup="true" aria-expanded="false">商品管理<span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="#">待发货</a></li>
                        <li><a href="#">已发货</a></li>
                        <li><a href="#">已签收</a></li>
                    </ul>
                </li>
            </ul>
            <form class="navbar-form navbar-left">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="搜索">
                </div>
                <button type="submit" class="btn btn-default">确认</button>
            </form>
            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                       aria-haspopup="true" aria-expanded="false">其他<span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="#">字体</a></li>
                        <li><a href="#">客服</a></li>
                        <li><a href="#">关于</a></li>
                        <li><a href="#">颜色</a></li>
                    </ul>
                </li>
                <li><a href="./src/login.html">登录</a></li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>

<div class="depot">
    <button class="bb" data-toggle="modal" data-target="#myModal1">添加商品</button>

    <!-- Modal -->
    <div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">添加商品</h4>
                </div>
                <div class="modal-body">

                    <div class="input-group">
                        <input type="text" class="form-control sid2" placeholder="商品id" aria-describedby="basic-addon1">
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-control sname2" placeholder="商品名" aria-describedby="basic-addon1">
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-control sintr2" placeholder="商品介绍" aria-describedby="basic-addon1">
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-control spri2" placeholder="商品价格" aria-describedby="basic-addon1">
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-control snum2" placeholder="库存" aria-describedby="basic-addon1">
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-control sstate2" placeholder="是否上架（1/0）" aria-describedby="basic-addon1">
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-control smoq2" placeholder="起订量" aria-describedby="basic-addon1">
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-control fre2" placeholder="运费" aria-describedby="basic-addon1">
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-control out2" placeholder="已出库" aria-describedby="basic-addon1">
                    </div>

                    <div class="input-group">
                        <input type="file" id="wj" class="form-control pho2" placeholder="上传图片" aria-describedby="basic-addon1"/>
                        <input type="submit" value="确认上传" name="subUpload" class="phosc"/>
                    </div>
                    <div class="input-group">
                    图片路径：<span class="phoroad"></span>
                    </div>


                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary scombc" data-dismiss="modal">保存</button>
                </div>
            </div>
        </div>
    </div>

    <button class="bb" data-toggle="modal" data-target="#myModal">修改商品</button>
    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel1">请输入修改的id和修改信息</h4>
                </div>
                <div class="modal-body">

                    <div class="input-group">
                        <input type="text" class="form-control sid3" placeholder="要修改的商品id" aria-describedby="basic-addon1">
                        <input type="submit" value="查询信息" name="subUpload" class="phoxg"/>
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-control sname3" placeholder="商品名" aria-describedby="basic-addon1">
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-control sintr3" placeholder="商品介绍" aria-describedby="basic-addon1">
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-control spri3" placeholder="商品价格" aria-describedby="basic-addon1">
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-control snum3" placeholder="库存" aria-describedby="basic-addon1">
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-control sstate3" placeholder="是否上架（1/0）" aria-describedby="basic-addon1">
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-control smoq3" placeholder="起订量" aria-describedby="basic-addon1">
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-control fre3" placeholder="运费" aria-describedby="basic-addon1">
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-control out3" placeholder="已出库" aria-describedby="basic-addon1">
                    </div>
                    <div class="input-group">
                        <input type="text" class="form-control pho3" placeholder="上传图片" aria-describedby="basic-addon1" value="phopath">

                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary scomxg" data-dismiss="modal">保存</button>
                </div>
            </div>
        </div>
    </div>
    <div class="row container center-block">
        <table class="table table-striped table-bordered">
            <thead>
            <tr>
                <td class="col-md-1 sid">商品id</td>
                <!--<td class="col-md-1">商品图</td>-->
                <td class="col-md-1 snamne">商品名</td>
                <!--  <td class="col-md-1">商品价格</td>-->
                <!-- <td class="col-md-1">起订量</td>
                 <td class="col-md-1">快递费</td>-->
                <td class="col-md-1 ssell">已售</td>
                <td class="col-md-1 shave">库存</td>
                <td class="col-md-1 stake">是否上架</td>
                <td class="col-md-1 sdel">删除</td>
            </tr>
            </thead>
            <tbody id="content1">
            </tbody>
        </table>
    </div>
    <div class="pagers">
        <nav aria-label="Page navigation" align="center">

            <ul class="pagination pagerul input-group" style="width: 20%;">
                <li><span aria-hidden="true" class="lastpage">&laquo;</span></li>
                <li>
                    <input type="text" value="1" class="form-control forpage" style="width: 50px;">
                </li>
                <li><span class="gotopage">跳转</span></li>
                <li><span aria-hidden="true" class="nextpage">&raquo;</span></li>
            </ul>

        </nav>
    </div>
</div>
<script>

    function reflash() {
        $("#content1").empty();

        $.ajax({
            url: "http://localhost:8080/scom/pager?a=1&b=4",//请求的接口路径
            type: "get",//请求方式
            contentType: "application/json;charset=UTF-8",
            dataType: "json",
            success: function (res) {
                if (res.status == "200") {
                    for (one in res.data.records) {
                        $("#content1").append(` <tr>\n' +
                              '            <td class="col-md-2 sid">${res.data.records[one].scomid}</td>\n'+
                            '            <td class="col-md-2 snamne">${res.data.records[one].scomname}</td>\n'+
                            '            <td class="col-md-2 ssell">${res.data.records[one].outbound}</td>\n' +
                            '            <td class="col-md-2 shave">${res.data.records[one].scomnum}</td>\n' +
                            '            <td class="col-md-2 stake">${res.data.records[one].scomstate}</td>\n' +
                            '            <td class="col-md-3 sdel"><button class="del" >删除</button></td>\n' +
                            '        </tr>`)
                    }
                    $(".del").click(function (){
                        var rows = this.parentNode.parentNode.children[0].innerText
                        console.log(rows)
                        $.ajax({
                            url: "http://localhost:8080/scom/delete",//请求的接口路径
                            type: "post",//请求方式
                            contentType: "application/json;charset=UTF-8",
                            dataType: "json",
                            data:JSON.stringify({
                                "scomid":rows
                            }),
                            success: function (res) {
                                reflash()
                            },
                            error: function () {
                                alert("err")
                            }
                        })
                    })

                }
            },
            error: function () {
                alert("添加失败")
            }
        })
    }

    $(function () {
        reflash()
    })

    $(".phosc").click(function (){
        //1.利用FormData内置对象
        let obj = new FormData();
        //3.添加文件对象,$('#d3')取索引0，转为原生jQuery对象即原生标签对象，再用files[0]就获得用户传的文件对象
        obj.append("a","giao")
        obj.append('file',$('#wj')[0].files[0])
        //4.将对象基于ajax发送到后端
        $.ajax({
            url:'http://localhost:8080/updateImage',
            type:'post',
            data:obj, //直接将对象放在data中即可
            // ajax 发送文件必须指定两个参数
            contentType:false, //告诉浏览器不需要带任何编码，Django后端能够自动识别formdata对象，
            processData: false, //告诉浏览器，不要对数据进行任何处理，原封不动发送到后端。
            success:function (args){
              $(".phoroad").text(args)
            },error:function (){
                alert("图片上传有误")
            }
        })
    })
    $(".scombc").click(function (){
        var phoroad =$(".phoroad").text();
        var sid2=$(".sid2").val()
        var sname2=$(".sname2").val()
        var sintr2 = $(".sintr2").val()
        var pho2 = phoroad/*$(".pho2").val()*/
        var out2 = $(".out2").val()
        var fre2 = $(".fre2").val()
        var smoq2 = $(".smoq2").val()
        var sstate2 = $(".sstate2").val()
        var snum2 = $(".snum2").val()
        var spri2 = $(".spri2").val()

        $.ajax({
            url: "http://localhost:8080/scom/add",//请求的接口路径
            type: "post",//请求方式
            contentType: "application/json;charset=UTF-8",
            dataType: "json",
            data:JSON.stringify({
                "scomid":sid2,
                "scomname":sname2,
                "sconintr":sintr2,
                "scompho":pho2,
                "scomprice":spri2,
                "scomnum":snum2,
                "scomstate":sstate2,
                "scommoq":smoq2,
                "freight":fre2,
                "outbound":out2
            }),
            success: function (res) {
                reflash()

            },
            error: function () {
                alert("err")
            }
        })
    })
    $(".phoxg").click(function (){
        var id = $(".sid3").val()
        $.ajax({
            url: "http://localhost:8080/scom/selectid",//请求的接口路径
            type: "get",//请求方式
            contentType: "charset=UTF-8",
            dataType: "json",
            data: {
                "scomid": id
            },
            success: function (res) {
                $(".sname3").val(res.data.scomname)
                $(".sintr3").val(res.data.scomintr)
                $(".pho3").val(res.data.scompho)
                $(".out3").val(res.data.outbound)
                $(".fre3").val(res.data.freight)
                $(".smoq3").val(res.data.scommoq)
                $(".sstate3").val(res.data.scomstate)
                $(".snum3").val(res.data.scomnum)
                $(".spri3").val(res.data.scomprice)
            },
            error: function () {
                alert("err")
            }
        })
    })

    $(".scomxg").click(function (){
        var sid3=$(".sid3").val()
        var sname3=$(".sname3").val()
        var sintr3 = $(".sintr3").val()
        var pho3 = $(".pho3").val()
        var out3 = $(".out3").val()
        var fre3 = $(".fre3").val()
        var smoq3 = $(".smoq3").val()
        var sstate3 = $(".sstate3").val()
        var snum3 = $(".snum3").val()
        var spri3 = $(".spri3").val()
        $.ajax({
            url: "http://localhost:8080/scom/update",//请求的接口路径
            type: "post",//请求方式
            contentType: "application/json;charset=UTF-8",
            dataType: "json",
            data:JSON.stringify({
                "scomname":sname3,
                "sconintr":sintr3,
                "scompho":pho3,
                "scomprice":spri3,
                "scomnum":snum3,
                "scomstate":sstate3,
                "scommoq":smoq3,
                "freight":fre3,
                "outbound":out3,
                "scomid":sid3
            }),
            success: function (res) {
                reflash()
            },
            error: function () {
                alert("err")
            }
        })
    })

$(".gotopage").click(function (){
    $("#content1").empty();
    var page = $(".forpage").val()
    $.ajax({
        url: "http://localhost:8080/scom/pager?a="+page+"&b=4",//请求的接口路径
        type: "get",//请求方式
        contentType: "application/json;charset=UTF-8",
        dataType: "json",
        success: function (res) {
            if (res.status == "200") {
                for (one in res.data.records) {
                    $("#content1").append(` <tr>\n' +
                              '            <td class="col-md-2 sid">${res.data.records[one].scomid}</td>\n'+
                            '            <td class="col-md-2 snamne">${res.data.records[one].scomname}</td>\n'+
                            '            <td class="col-md-2 ssell">${res.data.records[one].outbound}</td>\n' +
                            '            <td class="col-md-2 shave">${res.data.records[one].scomnum}</td>\n' +
                            '            <td class="col-md-2 stake">${res.data.records[one].scomstate}</td>\n' +
                            '            <td class="col-md-3 sdel"><button class="del" >删除</button></td>\n' +
                            '        </tr>`)
                }
                $(".del").click(function (){
                    var rows = this.parentNode.parentNode.children[0].innerText
                    console.log(rows)
                    $.ajax({
                        url: "http://localhost:8080/scom/delete",//请求的接口路径
                        type: "post",//请求方式
                        contentType: "application/json;charset=UTF-8",
                        dataType: "json",
                        data:JSON.stringify({
                            "scomid":rows
                        }),
                        success: function (res) {
                            reflash()
                        },
                        error: function () {
                            alert("err")
                        }
                    })
                })

            }
        },
        error: function () {
            alert("添加失败")
        }
    })
})
    $(".nextpage").click(function (){
        $("#content1").empty();
        var page = $(".forpage").val()
        var p = parseInt(page)
        p=p+1
        $(".forpage").val(p)
        $.ajax({
            url: "http://localhost:8080/scom/pager?a="+$(".forpage").val() +"&b=4",//请求的接口路径
            type: "get",//请求方式
            contentType: "application/json;charset=UTF-8",
            dataType: "json",
            success: function (res) {
                if (res.status == "200") {
                    for (one in res.data.records) {
                        $("#content1").append(` <tr>\n' +
                              '            <td class="col-md-2 sid">${res.data.records[one].scomid}</td>\n'+
                            '            <td class="col-md-2 snamne">${res.data.records[one].scomname}</td>\n'+
                            '            <td class="col-md-2 ssell">${res.data.records[one].outbound}</td>\n' +
                            '            <td class="col-md-2 shave">${res.data.records[one].scomnum}</td>\n' +
                            '            <td class="col-md-2 stake">${res.data.records[one].scomstate}</td>\n' +
                            '            <td class="col-md-3 sdel"><button class="del" >删除</button></td>\n' +
                            '        </tr>`)
                    }
                    $(".del").click(function (){
                        var rows = this.parentNode.parentNode.children[0].innerText
                        console.log(rows)
                        $.ajax({
                            url: "http://localhost:8080/scom/delete",//请求的接口路径
                            type: "post",//请求方式
                            contentType: "application/json;charset=UTF-8",
                            dataType: "json",
                            data:JSON.stringify({
                                "scomid":rows
                            }),
                            success: function (res) {
                                reflash()
                            },
                            error: function () {
                                alert("err")
                            }
                        })
                    })

                }
            },
            error: function () {
                alert("添加失败")
            }
        })
    })

    $(".lastpage").click(function (){
        $("#content1").empty();
        var page = $(".forpage").val()
        var p = parseInt(page)
        p=p-1
        $(".forpage").val(p)
        $.ajax({
            url: "http://localhost:8080/scom/pager?a="+$(".forpage").val() +"&b=4",//请求的接口路径
            type: "get",//请求方式
            contentType: "application/json;charset=UTF-8",
            dataType: "json",
            success: function (res) {
                if (res.status == "200") {
                    for (one in res.data.records) {
                        $("#content1").append(` <tr>\n' +
                              '            <td class="col-md-2 sid">${res.data.records[one].scomid}</td>\n'+
                            '            <td class="col-md-2 snamne">${res.data.records[one].scomname}</td>\n'+
                            '            <td class="col-md-2 ssell">${res.data.records[one].outbound}</td>\n' +
                            '            <td class="col-md-2 shave">${res.data.records[one].scomnum}</td>\n' +
                            '            <td class="col-md-2 stake">${res.data.records[one].scomstate}</td>\n' +
                            '            <td class="col-md-3 sdel"><button class="del" >删除</button></td>\n' +
                            '        </tr>`)
                    }
                    $(".del").click(function (){
                        var rows = this.parentNode.parentNode.children[0].innerText
                        console.log(rows)
                        $.ajax({
                            url: "http://localhost:8080/scom/delete",//请求的接口路径
                            type: "post",//请求方式
                            contentType: "application/json;charset=UTF-8",
                            dataType: "json",
                            data:JSON.stringify({
                                "scomid":rows
                            }),
                            success: function (res) {
                                reflash()
                            },
                            error: function () {
                                alert("err")
                            }
                        })
                    })

                }
            },
            error: function () {
                alert("添加失败")
            }
        })
    })

</script>
</body>
</html>